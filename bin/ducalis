#!/usr/bin/env ruby
# frozen_string_literal: true

require 'rubocop'
require 'policial'
require 'benchmark'
require 'git'

def process_args!
  flag = PatchedRubocop::MODES.keys
                              .map { |key| key if ARGV.delete("--#{key}") }
                              .find { |possible_flag| !possible_flag.nil? }
  PatchedRubocop.configure!(flag || :all)
end

if ARGV.any? { |arg| arg == '--ci' }
  require './lib/cli.rb'

  CLI.start(ARGV - %w[--ci])
else
  require './lib/patched_rubocop/rubo_cop.rb'

  process_args!

  result = 0
  cli = RuboCop::CLI.new
  time = Benchmark.realtime do
    result = cli.run
  end

  puts "Finished in #{time} seconds" if cli.options[:debug]
  puts "\033[42mBuild still green. Nothing to worry about\033[0m" if result != 0
end

exit 0
